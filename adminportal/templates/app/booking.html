<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - Khar Skardu</title>
    <script src="https://cdn.tailwindcss.com"></script>
<link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
<link rel="manifest" href="/static/icons/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

    <style>
        body { font-family: 'Lato', sans-serif; background-color: #FBF5EE; }
        .font-playfair { font-family: 'Playfair Display', serif; }
        
        /* Styles for Flatpickr */
        .flatpickr-calendar { background: #fff; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid #e2d9ce; }
        .flatpickr-months .flatpickr-month, .flatpickr-months .arrow { color: #6b4f4b; fill: #6b4f4b; }
        .flatpickr-day.selected { background: #92400e; border-color: #92400e; }
        .flatpickr-day:hover { background: #fef3c7; }

        /* Styles for Intl-Tel-Input */
        .iti { width: 100%; }
        .iti__flag-container { border-right: 1px solid #d1d5db; }
    </style>
</head>
<body class="text-gray-800">

    <main id="main-content">
        <nav id="navbar" class="text-white px-6 py-4 flex justify-between items-center fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-black bg-opacity-50 backdrop-blur-sm shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <a href="#" class="font-playfair text-2xl font-bold">Khar Skardu</a>
                <div class="hidden md:flex space-x-6 items-center">
                    <a href="#" class="hover:text-amber-200 transition-colors">Home</a>
                    <a href="#" class="hover:text-amber-200 transition-colors">Rooms</a>
                </div>
            </div>
        </nav>
        <!-- message -->
        {% if error_message %}
        <div class="container mx-auto px-6 pt-32">
            <div class="mb-4 p-4 rounded-lg bg-red-100 text-red-800 shadow-md">
                {{ error_message }}
            </div>
        </div>
        {% endif %}
        
        <div class="container mx-auto px-6 pt-24 flex flex-col lg:flex-row lg:justify-center gap-8">
            <div class="w-full lg:w-2/3">
                <h1 class="font-playfair text-3xl md:text-4xl font-bold text-amber-900 text-center mb-6">Available Rooms & Suites</h1>

                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <form method="GET" action="{% url 'booking' %}" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="space-y-1">
                            <label for="checkin" class="text-sm font-semibold text-gray-600">Check-in</label>
                            <input type="text" name="checkin" value="{{ checkin|date:'Y-m-d' }}" id="checkin" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="space-y-1">
                            <label for="checkout" class="text-sm font-semibold text-gray-600">Check-out</label>
                            <input type="text" value="{{ checkout|date:'Y-m-d' }}" name="checkout" id="checkout" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="space-y-1">
                            <label for="guests" class="text-sm font-semibold text-gray-600">Guests</label>
                            <input type="text" name="guests" id="guests" value="1 Room, 2 Guests" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <button type="submit" class="w-full bg-amber-800 hover:bg-amber-900 text-white font-bold p-2 rounded-lg transition-colors h-10 flex items-center justify-center">
                            Search
                        </button>
                    </form>
                </div>
                
                
                {% for room in available_rooms %}
                <div class="room-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col md:flex-row mb-8 transition duration-300 hover:shadow-2xl hover:-translate-y-1" 
                     data-room-id="{{ room.id }}"
                     data-room-title="{{ room.title }}"
                     data-room-price="{{ room.price }}"
                     data-room-image="{{ room.image_url }}">
                    <div class="md:w-1/3">
                        <img src="{{ room.image_url }}" alt="{{ room.title }}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6 flex flex-col justify-between flex-grow">
                        <div>
                            <h3 class="font-playfair text-2xl font-bold text-amber-900">{{ room.title }}</h3>
                            <p class="text-sm text-gray-500 mt-1">Accommodates 2 Guests</p>
                            
                            <div class="flex flex-wrap gap-2 mt-4 pt-3 border-t">
                                <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.247l-.384.384a1.5 1.5 0 01-2.121 0l-.384-.384M12 18.75v.008z" /></svg>
                                    Free Wi-Fi
                                </span>
                                <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859M12 3v8.25m0 0l-3-3m3 3l3-3" /></svg>
                                    Free Parking
                                </span>
                                <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                                    Air-conditioned
                                </span>
                                 <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5v-13A1.5 1.5 0 0015.5 2h-11zM10 9a3 3 0 100-6 3 3 0 000 6zM5 11.5a.5.5 0 01.5-.5h9a.5.5 0 010 1h-9a.5.5 0 01-.5-.5zM6 14.5a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5z" /></svg>
                                    Free Breakfast
                                </span>
                                <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5v-1.875a3.375 3.375 0 003.375-3.375h1.5a1.125 1.125 0 011.125 1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 003.375 3.375z" /></svg>
                                    Laundry Service
                                </span>
                                <span class="inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3.5a1.5 1.5 0 01.525 2.925l.845 3.381a1.5 1.5 0 01-2.74 1.158l-.348-.87a1.5 1.5 0 00-2.562 0l-.348.87a1.5 1.5 0 01-2.74-1.158l.845-3.381A1.5 1.5 0 0110 3.5zM8.5 12.5a.5.5 0 00-1 0v4a.5.5 0 001 0v-4zM11.5 12.5a.5.5 0 00-1 0v4a.5.5 0 001 0v-4z" /></svg>
                                    Accessible
                                </span>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t flex justify-between items-center">
                            <div>
                                <span class="text-xl font-bold text-amber-800">PKR {{ room.price|floatformat:0 }}</span>
                                <span class="text-gray-500 text-sm">/ night</span>
                            </div>
                            <button class="quick-book-btn bg-amber-800 hover:bg-amber-900 text-white font-bold py-2 px-5 rounded-lg text-sm">Book Now</button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-gray-600">No rooms available for the selected dates.</p>
                {% endfor %}
            </div>

            <div id="checkoutWrapper" class="w-full lg:w-1/3 hidden">
                <div class="bg-white rounded-xl shadow-2xl p-8 sticky top-24">
                    <h2 class="font-playfair text-3xl font-bold text-amber-900 text-center border-b pb-4 mb-6">Your Stay</h2>
                    
                    <div id="selectedRoomDetails" class="mb-6"></div>
                    <div id="price-summary" class="mb-6 space-y-2 text-gray-700 hidden"></div>

                    <div class="space-y-4">
                        <div>
                            <label for="fullName" class="text-sm font-semibold text-gray-600 block mb-1">Full Name</label>
                            <input type="text" id="fullName" placeholder="Enter your name" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="email" class="text-sm font-semibold text-gray-600 block mb-1">Email Address</label>
                            <input type="email" id="email" placeholder="Enter your email" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="phone" class="text-sm font-semibold text-gray-600 block mb-1">Mobile Number</label>
                            <input type="tel" id="phone" class="w-full border-gray-300 rounded-lg">
                        </div>

                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-center">
                            <p class="font-semibold text-sm text-blue-800">✔️ Pay at Property</p>
                            <p class="text-xs text-blue-600">No payment required today. You will pay when you check in.</p>
                        </div>
                        <button type="button" id="show-confirm-modal-btn" class="w-full bg-amber-800 hover:bg-amber-900 text-white font-bold py-3 px-5 rounded-lg transition-colors text-lg mt-2">Confirm Booking</button>
                    </div>
                </div>
            </div>
        </div>
        <section id="connect" class="py-20 bg-amber-50">
    <div class="container mx-auto px-6">
        
        <div class="text-center mb-12" data-aos="fade-up">
            <h2 class="font-playfair text-3xl md:text-4xl font-bold text-amber-900">Follow Our Journey</h2>
            <p class="mt-2 text-gray-600 max-w-2xl mx-auto">Stay updated with the latest stories, offers, and breathtaking moments from the mountains.</p>
        </div>

        <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-12 items-center">

            <div data-aos="fade-right" data-aos-duration="1000">
                <h3 class="font-playfair text-3xl font-bold text-amber-900 mb-8">Connect With Us</h3>
                
                <ul class="space-y-6">
                    <li>
                        <a href="https://www.instagram.com/kharskardu/?hl=en" class="group bg-white p-4 rounded-xl shadow-md flex items-center space-x-4 transition-all duration-300 hover:shadow-xl hover:scale-105">
                            <div class="bg-gradient-to-br from-yellow-400 via-red-500 to-purple-600 p-3 rounded-lg">
                               <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37zm1.5-4.87h.01"></path></svg>
                            </div>
                            <div>
                                <p class="font-bold text-lg text-gray-800">Instagram</p>
                                <p class="text-gray-500 group-hover:text-amber-800 transition-colors">@KharSkardu</p>
                            </div>
                        </a>
                    </li>

                    <li>
                        <a href="https://api.whatsapp.com/send?phone=923554779438" class="group bg-white p-4 rounded-xl shadow-md flex items-center space-x-4 transition-all duration-300 hover:shadow-xl hover:scale-105">
                            <div class="bg-green-500 p-3 rounded-lg">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 4.315 1.731 6.269l-.976 3.574 3.719-1.141z"></path></svg>
                            </div>
                            <div>
                                <p class="font-bold text-lg text-gray-800">WhatsApp</p>
                                <p class="text-gray-500 group-hover:text-amber-800 transition-colors">+92 339 1119555</p>
                                
                                <p class="text-gray-500 group-hover:text-amber-800 transition-colors">+92 355 4779438</p>

                            </div>
                        </a>
                    </li>

                    <li>
                        <a href="https://www.facebook.com/p/Khar-Hotel-Skardu-61575762743470/" class="group bg-white p-4 rounded-xl shadow-md flex items-center space-x-4 transition-all duration-300 hover:shadow-xl hover:scale-105">
                            <div class="bg-blue-600 p-3 rounded-lg">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg>
                            </div>
                            <div>
                                <p class="font-bold text-lg text-gray-800">Facebook</p>
                                <p class="text-gray-500 group-hover:text-amber-800 transition-colors">/KharSkarduHotel</p>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="flex items-center justify-center" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">
                <img src="/static/images/imagecontact.jpg" alt="A serene view from a cozy guesthouse balcony" class="rounded-xl shadow-2xl w-full h-auto object-cover transform md:rotate-3">
            </div>
        </div>
    </div>
</section>
    </main>

    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex justify-center items-center z-[100] hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg m-4" id="modal-content">
            <div class="p-8">
                <h2 class="font-playfair text-3xl font-bold text-amber-900 text-center mb-6">Final Confirmation</h2>
                
                <div id="modal-room-details" class="mb-4 text-center"></div>
                <div id="modal-guest-details" class="text-center"></div>
                
                <div class="my-6 text-center">
                    <p class="font-semibold text-gray-500 text-sm uppercase tracking-wider">Payment Method</p>
                    <p class="text-lg font-semibold text-gray-800">Pay at Property</p>
                </div>

                <div id="modal-price-summary" class="bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-2"></div>
            </div>

            <form action="{% url 'createbooking_app' %}" method="POST" class="bg-gray-50 px-8 py-5 rounded-b-xl">
                {% csrf_token %}
                <input type="hidden" name="room_id" id="modal_room_id">
                <input type="hidden" name="check_in_date" id="modal_check_in_date">
                <input type="hidden" name="check_out_date" id="modal_check_out_date">
                <input type="hidden" name="full_name" id="modal_full_name">
                <input type="hidden" name="email" id="modal_email">
                <input type="hidden" name="phone_number" id="modal_phone_number">
                <input type="hidden" name="total_price" id="modal_total_price">

                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-modal-btn" class="px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-amber-800 text-white font-bold rounded-lg hover:bg-amber-900">Confirm & Book</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const bookingState = { roomId: null, roomTitle: null, roomPrice: 0, checkinDate: null, checkoutDate: null, numNights: 0, totalPrice: 0 };
        const checkoutWrapper = document.getElementById('checkoutWrapper');
        const modal = document.getElementById('confirmationModal');
        const cancelModalBtn = document.getElementById('cancel-modal-btn');

        const phoneInputField = document.querySelector("#phone");
        const phoneInput = window.intlTelInput(phoneInputField, {
            initialCountry: "pk",
            separateDialCode: true,
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

        const currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'PKR', minimumFractionDigits: 0 });

        const checkoutPicker = flatpickr("#checkout", {
            dateFormat: "Y-m-d",
            onChange: (selectedDates) => {
                bookingState.checkoutDate = selectedDates[0];
                updatePriceSummary();
            },
        });

        const checkinPicker = flatpickr("#checkin", {
            minDate: "today",
            dateFormat: "Y-m-d",
            onChange: (selectedDates) => {
                // First, update the checkinDate in our state
                bookingState.checkinDate = selectedDates[0];
                
                // Calculate the earliest possible checkout date (the next day)
                const nextDay = new Date(bookingState.checkinDate);
                nextDay.setDate(nextDay.getDate() + 1);
                
                // Set the minimum date for the checkout picker
                checkoutPicker.set('minDate', nextDay);
                
                // Programmatically set the checkout date to the next day.
                // This will also trigger the checkoutPicker's onChange event,
                // ensuring updatePriceSummary() is called with the correct dates.
                checkoutPicker.setDate(nextDay);
            },
        });
        
        // --- Initialization Logic ---
        // Set initial check-in date to today if not already selected
        if (!checkinPicker.selectedDates.length) {
            checkinPicker.setDate(new Date());
        }
        bookingState.checkinDate = checkinPicker.selectedDates[0];
        
        // Set initial check-out date to tomorrow
        const initialCheckoutDate = new Date(bookingState.checkinDate);
        initialCheckoutDate.setDate(initialCheckoutDate.getDate() + 1);
        checkoutPicker.set('minDate', initialCheckoutDate);
        
        if (!checkoutPicker.selectedDates.length) {
            checkoutPicker.setDate(initialCheckoutDate);
        }
        bookingState.checkoutDate = checkoutPicker.selectedDates[0];
        
        // Always update price summary with initial dates
        updatePriceSummary();

        function updatePriceSummary() {
            if (!bookingState.checkinDate || !bookingState.checkoutDate || !bookingState.roomPrice || bookingState.checkoutDate <= bookingState.checkinDate) {
                document.getElementById('price-summary').classList.add('hidden');
                return;
            };

            const timeDiff = bookingState.checkoutDate.getTime() - bookingState.checkinDate.getTime();
            bookingState.numNights = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24)));
            bookingState.totalPrice = bookingState.roomPrice * bookingState.numNights;
            
            document.getElementById('price-summary').innerHTML = `<div class="flex justify-between text-sm"><span>${currencyFormatter.format(bookingState.roomPrice)} x ${bookingState.numNights} night(s)</span><span class="font-semibold">${currencyFormatter.format(bookingState.totalPrice)}</span></div><div class="flex justify-between text-xl font-bold text-amber-800 mt-2 pt-2 border-t"><span>Total Price</span><span>${currencyFormatter.format(bookingState.totalPrice)}</span></div>`;
            document.getElementById('price-summary').classList.remove('hidden');
        }

 function formatDateForInput(date) {
    const year = date.getFullYear();
    // getMonth() is 0-indexed, so we add 1. padStart ensures it's always 2 digits (e.g., 09).
    const month = String(date.getMonth() + 1).padStart(2, '0');
    // getDate() gets the day of the month.
    const day = String(date.getDate()).padStart(2, '0');
    
    return `${year}-${month}-${day}`;
}

function populateAndShowModal() {
    const fullName = document.getElementById('fullName').value;
    const email = document.getElementById('email').value;

    if (!fullName || !email) { alert('Please enter your full name and email address.'); return; }
    if (!phoneInput.isValidNumber()) { alert('Please enter a valid mobile number.'); return; }
    
    const phoneNumber = phoneInput.getNumber();

    // This part was already correct
    document.getElementById('modal-room-details').innerHTML = `<h3 class="font-playfair text-xl font-bold text-amber-800">${bookingState.roomTitle}</h3><p class="text-gray-600 text-sm">${bookingState.checkinDate.toLocaleDateString('en-GB', {day:'numeric', month:'long'})} - ${bookingState.checkoutDate.toLocaleDateString('en-GB', {day:'numeric', month:'long', year:'numeric'})}</p>`;
    document.getElementById('modal-guest-details').innerHTML = `<p class="font-semibold text-gray-800">${fullName}</p><p class="text-gray-500">${email}</p><p class="text-gray-500">${phoneNumber}</p>`;
    document.getElementById('modal-price-summary').innerHTML = `<div class="flex justify-between"><span>Total for ${bookingState.numNights} night(s)</span><span class="font-bold">${currencyFormatter.format(bookingState.totalPrice)}</span></div>`;

    document.getElementById('modal_room_id').value = bookingState.roomId;
    
    // --- THIS IS THE FIX ---
    // Instead of using .toISOString(), we use our new helper function
    document.getElementById('modal_check_in_date').value = formatDateForInput(bookingState.checkinDate);
    document.getElementById('modal_check_out_date').value = formatDateForInput(bookingState.checkoutDate);
    // --- END OF FIX ---

    document.getElementById('modal_full_name').value = fullName;
    document.getElementById('modal_email').value = email;
    document.getElementById('modal_phone_number').value = phoneNumber;
    document.getElementById('modal_total_price').value = bookingState.totalPrice;

    modal.classList.remove('hidden');
}document.querySelectorAll('.quick-book-btn').forEach(button => {
            button.addEventListener('click', function() {
                const roomCard = this.closest('.room-card');
                bookingState.roomId = roomCard.dataset.roomId;
                bookingState.roomTitle = roomCard.dataset.roomTitle;
                bookingState.roomPrice = parseFloat(roomCard.dataset.roomPrice);

                document.getElementById('selectedRoomDetails').innerHTML = `<div class="bg-amber-50 p-4 rounded-lg border border-amber-200"><h4 class="font-playfair text-lg font-bold text-amber-900">${bookingState.roomTitle}</h4><p class="font-semibold text-amber-800">${currencyFormatter.format(bookingState.roomPrice)} <span class="font-normal text-sm text-gray-600">/ night</span></p></div>`;
                
                updatePriceSummary();
                checkoutWrapper.classList.remove('hidden');
                checkoutWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        document.getElementById('show-confirm-modal-btn').addEventListener('click', populateAndShowModal);
        cancelModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', (e) => {
            if (e.target.id === 'confirmationModal') modal.classList.add('hidden');
        });
    });
</script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
</body>
</html>